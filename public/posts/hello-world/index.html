<!DOCTYPE html>
<html lang="en-us"
  dir="ltr">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width">








    


   
    <style>
    @import url("https://fonts.googleapis.com/css2?family=Open+Sans&display=swap");
    @import url("https://fonts.googleapis.com/css2?family=Inconsolata&display=swap");
</style>





<link rel="icon" type="image/ico" href="https://eventfd.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://eventfd.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://eventfd.github.io/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="192x192" href="https://eventfd.github.io/android-chrome-192x192.png">
<link rel="apple-touch-icon" sizes="180x180" href="https://eventfd.github.io/apple-touch-icon.png">

<meta name="description" content=""/>



<title>
    
    Fold Scan Fusion | eventfd&#39;s log
    
</title>

<link rel="canonical" href="https://eventfd.github.io/posts/hello-world/"/>

<meta property="og:url" content="https://eventfd.github.io/posts/hello-world/">
  <meta property="og:site_name" content="eventfd&#39;s log">
  <meta property="og:title" content="Fold Scan Fusion">
  <meta property="og:description" content="Exploring the Fold Scan Fusion property">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2026-01-02T00:00:00+00:00">
    <meta property="article:modified_time" content="2026-01-02T00:00:00+00:00">
    <meta property="article:tag" content="Haskell">












<link rel="stylesheet" href="/assets/combined.min.50f2346064be4aa70ca0fb5cf8cef9008da1d7facbfafd9c67f98a2c2389c1b3.css" media="all">















    




</head>



<body >

  <div class="content">
    <header>
      

<div class="header">

    

    <h1 class="header-title">
        <a href="https://eventfd.github.io/">eventfd&#39;s log</a>
    </h1>

    <div class="header-menu">
        

        
        

        <p
            class="small ">
            <a href="/posts" >
                /posts
            </a>
        </p>
        

        <p
            class="small ">
            <a href="/about" >
                /about
            </a>
        </p>
        
        
    </div>

    

</div>

    </header>

    <main class="main">
      




<div class="breadcrumbs"><a href="/">~</a><span class="breadcrumbs-separator">/</span><a href="/posts/">Posts</a><span class="breadcrumbs-separator">/</span>
        <a href="/posts/hello-world/">Fold Scan Fusion</a></div>


<div >
  <article>
    <header class="single-intro-container">
        
        <h1 class="single-title">Fold Scan Fusion</h1>
        <p class="single-summary">Exploring the Fold Scan Fusion property</p>
        
        <div class="single-subsummary">
          
          <div>
            
            <p class="single-date">
              <time datetime="2026-01-02T00:00:00&#43;00:00">2 Jan 2026</time>
              &nbsp; · &nbsp;5 min read
            </p>
          </div>
        </div>
        
    </header>
      <aside class="toc">
        <p><strong>Table of contents</strong></p>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#definition">Definition</a></li>
    <li><a href="#explanation">Explanation</a></li>
    <li><a href="#references">References</a></li>
  </ul>
</nav>
      </aside>
    
    <div class="single-content">
      <p>There&rsquo;s a very interesting property when it comes to <code>scan</code> and <code>fold</code>.</p>
<div class="code-block">
  <div class="code-header">
    <span class="code-lang">Definition
        
    </span>
    <pre style="display: none;">foldl f f0 . scanl g g0 === foldl h (f f0 g0, g0)
  where h (x, y) e = (f x (g y e), g y e)</pre>
    <button class="copy-code-button">
      <svg xmlns="http://www.w3.org/2000/svg"
        width="20px" height="20px"
        transform="translate(0, 3)"
        viewBox="0 -960 960 960"
        fill="currentColor">
        <path d="M360-240q-33 0-56.5-23.5T280-320v-480q0-33 23.5-56.5T360-880h360q33 0 56.5 23.5T800-800v480q0 33-23.5 56.5T720-240H360Zm0-80h360v-480H360v480ZM200-80q-33 0-56.5-23.5T120-160v-560h80v560h440v80H200Zm160-240v-480 480Z"/>
      </svg>
    </button>
  </div><div class="highlight" title="Definition"><pre tabindex="0" class="chroma"><code class="language-haskell" data-lang="haskell"><span class="line"><span class="ln">1</span><span class="cl"><span class="nf">foldl</span> <span class="n">f</span> <span class="n">f0</span> <span class="o">.</span> <span class="n">scanl</span> <span class="n">g</span> <span class="n">g0</span> <span class="o">===</span> <span class="n">foldl</span> <span class="n">h</span> <span class="p">(</span><span class="n">f</span> <span class="n">f0</span> <span class="n">g0</span><span class="p">,</span> <span class="n">g0</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">  <span class="kr">where</span> <span class="n">h</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="n">e</span> <span class="ow">=</span> <span class="p">(</span><span class="n">f</span> <span class="n">x</span> <span class="p">(</span><span class="n">g</span> <span class="n">y</span> <span class="n">e</span><span class="p">),</span> <span class="n">g</span> <span class="n">y</span> <span class="n">e</span><span class="p">)</span></span></span></code></pre></div></div>
<p>Feel free to <a href="#explanation">skip</a> the following section if you are familiar with <code>fold</code>s and <code>scan</code>s.</p>
<h2 class="heading" id="definition">
  Definition
  <a class="anchor" href="#definition">#</a>
</h2>
<div class="code-block">
  <div class="code-header">
    <span class="code-lang">scanl
        
    </span>
    <pre style="display: none;">def scanl(iter: Iterable[T], init: A, pred: Fn(A, T) -&gt; A) -&gt; Iterable[A] {
  for e in iter {
    yield init
    init = pred(init, e)
  }
}</pre>
    <button class="copy-code-button">
      <svg xmlns="http://www.w3.org/2000/svg"
        width="20px" height="20px"
        transform="translate(0, 3)"
        viewBox="0 -960 960 960"
        fill="currentColor">
        <path d="M360-240q-33 0-56.5-23.5T280-320v-480q0-33 23.5-56.5T360-880h360q33 0 56.5 23.5T800-800v480q0 33-23.5 56.5T720-240H360Zm0-80h360v-480H360v480ZM200-80q-33 0-56.5-23.5T120-160v-560h80v560h440v80H200Zm160-240v-480 480Z"/>
      </svg>
    </button>
  </div><div class="highlight" title="scanl"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="ln">1</span><span class="cl">def scanl(iter: Iterable[T], init: A, pred: Fn(A, T) -&gt; A) -&gt; Iterable[A] {
</span></span><span class="line"><span class="ln">2</span><span class="cl">  for e in iter {
</span></span><span class="line"><span class="ln">3</span><span class="cl">    yield init
</span></span><span class="line"><span class="ln">4</span><span class="cl">    init = pred(init, e)
</span></span><span class="line"><span class="ln">5</span><span class="cl">  }
</span></span><span class="line"><span class="ln">6</span><span class="cl">}</span></span></code></pre></div></div>
<div class="code-block">
  <div class="code-header">
    <span class="code-lang">foldl
        
    </span>
    <pre style="display: none;">def foldl(iter: Iterable[T], init: A, pred: Fn(A, T) -&gt; A) -&gt; A {
  for e in iter {
    init = pred(init, e)
  }
  return init
}</pre>
    <button class="copy-code-button">
      <svg xmlns="http://www.w3.org/2000/svg"
        width="20px" height="20px"
        transform="translate(0, 3)"
        viewBox="0 -960 960 960"
        fill="currentColor">
        <path d="M360-240q-33 0-56.5-23.5T280-320v-480q0-33 23.5-56.5T360-880h360q33 0 56.5 23.5T800-800v480q0 33-23.5 56.5T720-240H360Zm0-80h360v-480H360v480ZM200-80q-33 0-56.5-23.5T120-160v-560h80v560h440v80H200Zm160-240v-480 480Z"/>
      </svg>
    </button>
  </div><div class="highlight" title="foldl"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="ln">1</span><span class="cl">def foldl(iter: Iterable[T], init: A, pred: Fn(A, T) -&gt; A) -&gt; A {
</span></span><span class="line"><span class="ln">2</span><span class="cl">  for e in iter {
</span></span><span class="line"><span class="ln">3</span><span class="cl">    init = pred(init, e)
</span></span><span class="line"><span class="ln">4</span><span class="cl">  }
</span></span><span class="line"><span class="ln">5</span><span class="cl">  return init
</span></span><span class="line"><span class="ln">6</span><span class="cl">}</span></span></code></pre></div></div>
<p><code>fold</code> folds the iterable using <code>pred</code> as the function <em>accumulating</em> result on the way, whereas <code>scan</code> returns an iterable consisting of the intermediate results.</p>
<p>There are two variants of fold - <code>foldl</code> and <code>foldr</code>. The main difference is in the associativity, that is., <code>foldl</code> consumes the iterator from the beginning whereas <code>foldr</code> consumes it from the end.</p>
<h2 class="heading" id="explanation">
  Explanation
  <a class="anchor" href="#explanation">#</a>
</h2>
<p>Consider the following expression,</p>
<div class="code-block">
  <div class="code-header">
    <span class="code-lang">text
        
    </span>
    <pre style="display: none;">rv = fold(scan(list, g0, g), f0, f)</pre>
    <button class="copy-code-button">
      <svg xmlns="http://www.w3.org/2000/svg"
        width="20px" height="20px"
        transform="translate(0, 3)"
        viewBox="0 -960 960 960"
        fill="currentColor">
        <path d="M360-240q-33 0-56.5-23.5T280-320v-480q0-33 23.5-56.5T360-880h360q33 0 56.5 23.5T800-800v480q0 33-23.5 56.5T720-240H360Zm0-80h360v-480H360v480ZM200-80q-33 0-56.5-23.5T120-160v-560h80v560h440v80H200Zm160-240v-480 480Z"/>
      </svg>
    </button>
  </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">rv = fold(scan(list, g0, g), f0, f)</span></span></code></pre></div></div>
<p>Let&rsquo;s do a dry run here. Say, the elements of the list are denoted by <span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>e</mi><mi>i</mi></msub><mi mathvariant="normal">∀</mi><mtext> </mtext><mn>0</mn><mo>≤</mo><mi>i</mi><mo>&lt;</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">e_i \forall \ 0 \le i \lt n</annotation></semantics></math></span> where <span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span> represents the number of elements in the <code>list</code></p>
<p>The output of <code>scan</code> is </p>
<span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>s</mi><mo>=</mo><mrow><mo fence="true">[</mo><msub><mi>g</mi><mn>0</mn></msub><mo separator="true">,</mo><mi>g</mi><mo stretchy="false">(</mo><msub><mi>g</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi>e</mi><mn>0</mn></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>g</mi><mo stretchy="false">(</mo><mi>g</mi><mo stretchy="false">(</mo><msub><mi>g</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi>e</mi><mn>0</mn></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><msub><mi>e</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">s = \left[g_0, g(g_0, e_0), g(g(g_0, e_0), e_1), \cdots \right]</annotation></semantics></math></span><p>Now we apply fold to the new set of values:</p>

<div class="table-outer">
    <table>
        <thead>
            <tr>
                <th><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span></th>
                <th><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">s_i</annotation></semantics></math></span></th>
                <th><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><msub><mi>v</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">rv_i</annotation></semantics></math></span></th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span></td>
                <td><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">f_0</annotation></semantics></math></span></td>
                <td><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>g</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">g_0</annotation></semantics></math></span></td>
            </tr>
            <tr>
                <td><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span></td>
                <td><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi>e</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">g(s_0, e_0)</annotation></semantics></math></span></td>
                <td><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>r</mi><msub><mi>v</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi>s</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(rv_0, s_0)</annotation></semantics></math></span></td>
            </tr>
            <tr>
                <td><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span></td>
                <td><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>e</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">g(s_1, e_1)</annotation></semantics></math></span></td>
                <td><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>r</mi><msub><mi>v</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>s</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(rv_1, s_1)</annotation></semantics></math></span></td>
            </tr>
            <tr>
                <td><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⋯</mo></mrow><annotation encoding="application/x-tex">\cdots</annotation></semantics></math></span></td>
                <td><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⋯</mo></mrow><annotation encoding="application/x-tex">\cdots</annotation></semantics></math></span></td>
                <td><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⋯</mo></mrow><annotation encoding="application/x-tex">\cdots</annotation></semantics></math></span></td>
            </tr>
            <tr>
                <td><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k-1</annotation></semantics></math></span></td>
                <td><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mrow><mi>k</mi><mo>−</mo><mn>2</mn></mrow></msub><mo separator="true">,</mo><msub><mi>e</mi><mrow><mi>k</mi><mo>−</mo><mn>2</mn></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">g(s_{k-2}, e_{k-2})</annotation></semantics></math></span></td>
                <td><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>r</mi><msub><mi>v</mi><mrow><mi>k</mi><mo>−</mo><mn>2</mn></mrow></msub><mo separator="true">,</mo><msub><mi>s</mi><mrow><mi>k</mi><mo>−</mo><mn>2</mn></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(rv_{k-2}, s_{k-2})</annotation></semantics></math></span></td>
            </tr>
            <tr>
                <td><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span></td>
                <td><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>e</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">g(s_{k-1}, e_{k-1})</annotation></semantics></math></span></td>
                <td><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>r</mi><msub><mi>v</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>s</mi><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(rv_{k-1}, s_{k-1})</annotation></semantics></math></span></td>
            </tr>
        </tbody>
    </table>
</div><p>Observe that <span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><msub><mi>v</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">rv_i</annotation></semantics></math></span> is lagging behind <span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">s_i</annotation></semantics></math></span> as <span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">s_i</annotation></semantics></math></span> depends on <span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>e</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">e_{i-1}</annotation></semantics></math></span> whereas <span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><msub><mi>v</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">rv_i</annotation></semantics></math></span> depends on <span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">s_{i-1}</annotation></semantics></math></span> thereby depending on <span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>e</mi><mrow><mi>i</mi><mo>−</mo><mn>2</mn></mrow></msub></mrow><annotation encoding="application/x-tex">e_{i-2}</annotation></semantics></math></span>. Shifting up by one row for <span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><msub><mi>v</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">rv_i</annotation></semantics></math></span>, we get</p>

<div class="table-outer">
    <table>
        <thead>
            <tr>
                <th><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span></th>
                <th><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">s_i</annotation></semantics></math></span></th>
                <th><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><msub><mi>v</mi><mrow><mi>i</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">rv_{i+1}</annotation></semantics></math></span></th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span></td>
                <td><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">f_0</annotation></semantics></math></span></td>
                <td><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>r</mi><msub><mi>v</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi>s</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(rv_0, s_0)</annotation></semantics></math></span></td>
            </tr>
            <tr>
                <td><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span></td>
                <td><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi>e</mi><mn>0</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">g(s_0, e_0)</annotation></semantics></math></span></td>
                <td><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>r</mi><msub><mi>v</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>s</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(rv_1, s_1)</annotation></semantics></math></span></td>
            </tr>
            <tr>
                <td><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span></td>
                <td><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>e</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">g(s_1, e_1)</annotation></semantics></math></span></td>
                <td><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>r</mi><msub><mi>v</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>s</mi><mn>2</mn></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(rv_2, s_2)</annotation></semantics></math></span></td>
            </tr>
            <tr>
                <td><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⋯</mo></mrow><annotation encoding="application/x-tex">\cdots</annotation></semantics></math></span></td>
                <td><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⋯</mo></mrow><annotation encoding="application/x-tex">\cdots</annotation></semantics></math></span></td>
                <td><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⋯</mo></mrow><annotation encoding="application/x-tex">\cdots</annotation></semantics></math></span></td>
            </tr>
            <tr>
                <td><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n-1</annotation></semantics></math></span></td>
                <td><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow></msub><mo separator="true">,</mo><msub><mi>e</mi><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">g(s_{n-2}, e_{n-2})</annotation></semantics></math></span></td>
                <td><span class="katex"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>r</mi><msub><mi>v</mi><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>s</mi><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(rv_{n-1}, s_{n-1})</annotation></semantics></math></span></td>
            </tr>
        </tbody>
    </table>
</div><p>We get the following pseudocode</p>
<div class="code-block">
  <div class="code-header">
    <span class="code-lang">text
        
    </span>
    <pre style="display: none;">(s, rv) = (g[0], f(f[0], g[0]))
for e in list {
  s = g(s, e)
  rv = f(rv, s)
}</pre>
    <button class="copy-code-button">
      <svg xmlns="http://www.w3.org/2000/svg"
        width="20px" height="20px"
        transform="translate(0, 3)"
        viewBox="0 -960 960 960"
        fill="currentColor">
        <path d="M360-240q-33 0-56.5-23.5T280-320v-480q0-33 23.5-56.5T360-880h360q33 0 56.5 23.5T800-800v480q0 33-23.5 56.5T720-240H360Zm0-80h360v-480H360v480ZM200-80q-33 0-56.5-23.5T120-160v-560h80v560h440v80H200Zm160-240v-480 480Z"/>
      </svg>
    </button>
  </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">(s, rv) = (g[0], f(f[0], g[0]))
</span></span><span class="line"><span class="ln">2</span><span class="cl">for e in list {
</span></span><span class="line"><span class="ln">3</span><span class="cl">  s = g(s, e)
</span></span><span class="line"><span class="ln">4</span><span class="cl">  rv = f(rv, s)
</span></span><span class="line"><span class="ln">5</span><span class="cl">}</span></span></code></pre></div></div>
<p>If we keep a track of the pair <code>(s, rv)</code> at every iteration, we can reduce it into a single fold <code>h</code></p>
<p>Where <code>h</code> can be defined as</p>
<div class="code-block">
  <div class="code-header">
    <span class="code-lang">text
        
    </span>
    <pre style="display: none;">def h(s: A, rv: B, e: E) -&gt; (A, B) {
  s&#39; = g(s, e)
  rv&#39; = f(rv, s&#39;)
  return (s&#39;, rv&#39;)
}</pre>
    <button class="copy-code-button">
      <svg xmlns="http://www.w3.org/2000/svg"
        width="20px" height="20px"
        transform="translate(0, 3)"
        viewBox="0 -960 960 960"
        fill="currentColor">
        <path d="M360-240q-33 0-56.5-23.5T280-320v-480q0-33 23.5-56.5T360-880h360q33 0 56.5 23.5T800-800v480q0 33-23.5 56.5T720-240H360Zm0-80h360v-480H360v480ZM200-80q-33 0-56.5-23.5T120-160v-560h80v560h440v80H200Zm160-240v-480 480Z"/>
      </svg>
    </button>
  </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">def h(s: A, rv: B, e: E) -&gt; (A, B) {
</span></span><span class="line"><span class="ln">2</span><span class="cl">  s&#39; = g(s, e)
</span></span><span class="line"><span class="ln">3</span><span class="cl">  rv&#39; = f(rv, s&#39;)
</span></span><span class="line"><span class="ln">4</span><span class="cl">  return (s&#39;, rv&#39;)
</span></span><span class="line"><span class="ln">5</span><span class="cl">}</span></span></code></pre></div></div>
<p>Alright, let&rsquo;s run a quick property test</p>
<div class="code-block">
  <div class="code-header">
    <span class="code-lang">haskell
        
    </span>
    <pre style="display: none;">import Test.QuickCheck

foldScan f g f0 g0 = foldl f f0 . scanl g g0

fusedScan f g f0 g0 = snd . foldl h (g0, f f0 g0)
  where h (s, rv&#39;) e = (g s e, f rv&#39; (g s e))

foldFusion :: (Eq a, Show a) =&gt; (a -&gt; b -&gt; a) -&gt; (b -&gt; p -&gt; b) -&gt; a -&gt; b -&gt; [p] -&gt; Property
foldFusion f g f0 g0 xs = foldScan f g f0 g0 xs === fusedScan f g f0 g0 xs

-- define the concrete types for a sample property testing
propFoldFusion :: Fun (Int, Int) Int -&gt; Fun (Int, Int) Int -&gt; Int -&gt; Int -&gt; [Int] -&gt; Property
propFoldFusion (Fn2 f) (Fn2 g) = foldFusion f g

main :: IO ()
main = do
  quickCheck propFoldFusion</pre>
    <button class="copy-code-button">
      <svg xmlns="http://www.w3.org/2000/svg"
        width="20px" height="20px"
        transform="translate(0, 3)"
        viewBox="0 -960 960 960"
        fill="currentColor">
        <path d="M360-240q-33 0-56.5-23.5T280-320v-480q0-33 23.5-56.5T360-880h360q33 0 56.5 23.5T800-800v480q0 33-23.5 56.5T720-240H360Zm0-80h360v-480H360v480ZM200-80q-33 0-56.5-23.5T120-160v-560h80v560h440v80H200Zm160-240v-480 480Z"/>
      </svg>
    </button>
  </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-haskell" data-lang="haskell"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kr">import</span> <span class="nn">Test.QuickCheck</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="nf">foldScan</span> <span class="n">f</span> <span class="n">g</span> <span class="n">f0</span> <span class="n">g0</span> <span class="ow">=</span> <span class="n">foldl</span> <span class="n">f</span> <span class="n">f0</span> <span class="o">.</span> <span class="n">scanl</span> <span class="n">g</span> <span class="n">g0</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="nf">fusedScan</span> <span class="n">f</span> <span class="n">g</span> <span class="n">f0</span> <span class="n">g0</span> <span class="ow">=</span> <span class="n">snd</span> <span class="o">.</span> <span class="n">foldl</span> <span class="n">h</span> <span class="p">(</span><span class="n">g0</span><span class="p">,</span> <span class="n">f</span> <span class="n">f0</span> <span class="n">g0</span><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="kr">where</span> <span class="n">h</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">rv&#39;</span><span class="p">)</span> <span class="n">e</span> <span class="ow">=</span> <span class="p">(</span><span class="n">g</span> <span class="n">s</span> <span class="n">e</span><span class="p">,</span> <span class="n">f</span> <span class="n">rv&#39;</span> <span class="p">(</span><span class="n">g</span> <span class="n">s</span> <span class="n">e</span><span class="p">))</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="nf">foldFusion</span> <span class="ow">::</span> <span class="p">(</span><span class="kt">Eq</span> <span class="n">a</span><span class="p">,</span> <span class="kt">Show</span> <span class="n">a</span><span class="p">)</span> <span class="ow">=&gt;</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="n">a</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">b</span> <span class="ow">-&gt;</span> <span class="n">p</span> <span class="ow">-&gt;</span> <span class="n">b</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="kt">Property</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="nf">foldFusion</span> <span class="n">f</span> <span class="n">g</span> <span class="n">f0</span> <span class="n">g0</span> <span class="n">xs</span> <span class="ow">=</span> <span class="n">foldScan</span> <span class="n">f</span> <span class="n">g</span> <span class="n">f0</span> <span class="n">g0</span> <span class="n">xs</span> <span class="o">===</span> <span class="n">fusedScan</span> <span class="n">f</span> <span class="n">g</span> <span class="n">f0</span> <span class="n">g0</span> <span class="n">xs</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="c1">-- define the concrete types for a sample property testing</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nf">propFoldFusion</span> <span class="ow">::</span> <span class="kt">Fun</span> <span class="p">(</span><span class="kt">Int</span><span class="p">,</span> <span class="kt">Int</span><span class="p">)</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Fun</span> <span class="p">(</span><span class="kt">Int</span><span class="p">,</span> <span class="kt">Int</span><span class="p">)</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="kt">Int</span><span class="p">]</span> <span class="ow">-&gt;</span> <span class="kt">Property</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="nf">propFoldFusion</span> <span class="p">(</span><span class="kt">Fn2</span> <span class="n">f</span><span class="p">)</span> <span class="p">(</span><span class="kt">Fn2</span> <span class="n">g</span><span class="p">)</span> <span class="ow">=</span> <span class="n">foldFusion</span> <span class="n">f</span> <span class="n">g</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="nf">main</span> <span class="ow">::</span> <span class="kt">IO</span> <span class="nb">()</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="n">quickCheck</span> <span class="n">propFoldFusion</span></span></span></code></pre></div></div>
<p>And, here&rsquo;s the output:</p>
<div class="code-block">
  <div class="code-header">
    <span class="code-lang">shell
        
    </span>
    <pre style="display: none;">$ stack test
...
testing&gt; test (suite: testing-test)
                     
&#43;&#43;&#43; OK, passed 100 tests.

testing&gt; Test suite testing-test passed
Completed 2 action(s).</pre>
    <button class="copy-code-button">
      <svg xmlns="http://www.w3.org/2000/svg"
        width="20px" height="20px"
        transform="translate(0, 3)"
        viewBox="0 -960 960 960"
        fill="currentColor">
        <path d="M360-240q-33 0-56.5-23.5T280-320v-480q0-33 23.5-56.5T360-880h360q33 0 56.5 23.5T800-800v480q0 33-23.5 56.5T720-240H360Zm0-80h360v-480H360v480ZM200-80q-33 0-56.5-23.5T120-160v-560h80v560h440v80H200Zm160-240v-480 480Z"/>
      </svg>
    </button>
  </div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="ln">1</span><span class="cl">$ stack <span class="nb">test</span>
</span></span><span class="line"><span class="ln">2</span><span class="cl">...
</span></span><span class="line"><span class="ln">3</span><span class="cl">testing&gt; <span class="nb">test</span> <span class="o">(</span>suite: testing-test<span class="o">)</span>
</span></span><span class="line"><span class="ln">4</span><span class="cl">                     
</span></span><span class="line"><span class="ln">5</span><span class="cl">+++ OK, passed <span class="m">100</span> tests.
</span></span><span class="line"><span class="ln">6</span><span class="cl">
</span></span><span class="line"><span class="ln">7</span><span class="cl">testing&gt; Test suite testing-test passed
</span></span><span class="line"><span class="ln">8</span><span class="cl">Completed <span class="m">2</span> action<span class="o">(</span>s<span class="o">)</span>.</span></span></code></pre></div></div>
<h2 class="heading" id="references">
  References
  <a class="anchor" href="#references">#</a>
</h2>
<ul>
<li><code>Algebraic Identities for Program Calculation</code> by Richard Bird</li>
</ul>

    </div>
  </article>

  

  

  
  

  

  

  
  <div class="back-to-top">
    <a href="#top">
      back to top
    </a>
  </div>
  

</div>


    </main>
  </div>

  
  





    




  <footer>
    

    
    





    




    
    <p>Powered by
        <a href="https://gohugo.io/">Hugo</a>
        and
        <a href="https://github.com/tomfran/typo">tomfran/typo</a>
    </p>
    
    
    


  </footer>

  
</body>

<script defer src="/js/copy-code.js"></script>
</html>
